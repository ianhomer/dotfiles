#!/usr/bin/env bash

# Doctor dotfiles environment
#

set -e

should-run -m 7d $@ $0 || exit 0

$(shim) && . ${ME}/i.sh

# Ensure dotme .env file exists
dotmeEnvFile=~/.config/dotme/.env
if [ ! -f "$dotmeEnvFile" ] ; then
  log:: "Creating $dotmeEnvFile"
  touch $dotmeEnvFile
fi

should-run -fu $0

gnupgPermissions=$(stat -f %A ~/.gnupg)
if [ "$gnupgPermissions" != 700 ] ; then
  log:: "Correcting ~/.gnupg permissions from $gnupgPermissions to 700"
  chmod 700 ~/.gnupg
fi
