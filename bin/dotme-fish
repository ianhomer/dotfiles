#!/usr/bin/env fish
#
# Configure fish
#

should-run -m 7 $argv dotme-fish || exit 0

printf "\e[36mConfiguring fish shell\e[0m\n"

if not grep -q "/fish" /etc/shells
  echo "! Please add "(which fish)" to /etc/shells"
  echo "! You'll need to enter your password for this"
  echo "! echo "(which fish)" | sudo tee -a /etc/shells"
  echo "! chsh -s "(which fish)
  exit 1
end

#
# Set up path note that this include
#
# - ~/.dotfiles/bin <- scripts from these dotfiles
# - ~/bin           <- local overrides
#
#

# See https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally
# fish_add_path ~/.npm-global/bin

fish_add_path ~/bin
fish_add_path ~/.jenv/shims
fish_add_path ~/.dotfiles/bin
fish_add_path ~/.pyenv/bin
fish_add_path ~/.jenv/bin
fish_add_path ~/.cargo/bin
fish_add_path ~/.rbenv/shims
fish_add_path ~/Library/Python/3.9/bin
if is-silicon
  fish_add_path /opt/homebrew/bin
  fish_add_path /opt/homebrew/sbin
  if test -d /opt/homebrew/opt/python@3.10
    fish_add_path /opt/homebrew/opt/python@3.10/libexec/bin
  end
else
  fish_add_path /usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/bin
end

# Android development
fish_add_path ~/Library/Android/sdk/emulator
fish_add_path ~/Library/Android/sdk/platform-tools

# Why was this in?
# fish_add_path /usr/local/sbin

#
# See https://github.com/fish-shell/fish-shell/issues/2639 to
# remove elements from fish path, e.g.
#
# echo $fish_user_paths | tr " " "\n" | nl
# set --erase --universal fish_user_paths[1]
#

# Link in docker completions
set dockerCompletions ~/.config/fish/completions/docker.fish
if not test -L $dockerCompletions
  ln -s /Applications/Docker.app/Contents/Resources/etc/docker.fish-completion $dockerCompletions
end

set -U fish_greeting ""

set -U tide_right_prompt_items status cmd_duration
set -U dirprev

should-run -fu dotme-fish
