#!/usr/bin/env bash

#
# Install vim plug - vi plugin manager
#

should-run -m 7 $0 || exit

if [ ! -f  ~/.vim/autoload/plug.vim ] ; then
  curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi

# Plug now autoloaded from vim autoload directory as single source of truth
if [ -f  ~/.local/share/nvim/site/autoload/plug.vim ] ; then
  rm ~/.local/share/nvim/site/autoload/plug.vim
fi

if [ ! -d ~/.vim/backups ] ; then
  mkdir ~/.vim/backups
fi

if [ ! -d ~/.vim/swaps ] ; then
  mkdir ~/.vim/swaps
fi

if [ ! -d ~/.cache/tags ] ; then
  mkdir ~/.cache/tags
fi

# Update plugins used in power mode
export VIM_KNOB=6

# update neovim
nvim +PlugUpgrade +PlugUpdate +qa

should-run -fu $0
