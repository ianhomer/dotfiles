#!/usr/bin/env bash

if [ ! -d "$1" ] ; then
  echo "Not a directory $1"
  exit 1
fi

if [ -z "$2" ] ; then
  echo "recipient is empty"
  exit 1
fi

if [ ! -d "~/backups" ] ; then
  echo "Creating backups directory"
  mkdir ~/backups
fi

stamp=$(date "+%Y%m%d-%H%M%S")
base=$(basename $1)

echo "Encrypting directory : $1 ($base) for $2 : $stamp"

tar --exclude .git -czvf - $1 |
  gpg --encrypt --recipient $2         \
  --output ~/backups/back-$base-$stamp.tar.gz.gpg

# To decrypt
#   gpg --output my.tar.gz --decrypt my.tar.gz.gpg
