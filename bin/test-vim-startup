#!/usr/bin/env python3

import argparse
import os
import subprocess
from timeit import Timer


def run():
    parser = argparse.ArgumentParser(description="test vim startup")
    parser.add_argument(
        "--iterations",  type=int, help="iterations", default=5
    )
    args = parser.parse_args()

    timeAll(args)


def timeAll(args):
    for knob in range(6):
        timeOne(["nvim", "+q"], knob, args)


def timeOne(command, knob, args):
    def process():
        subprocess.call(command, env={**os.environ, "VIM_KNOB": f"{knob}"})

    t = Timer(process)
    time = int(t.timeit(args.iterations) * 1000 / args.iterations)
    print(f"{knob} : {time}")


run()
