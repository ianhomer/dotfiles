#!/usr/bin/env bash

set -e

should-run -m 7d $@ $0 || exit 0

$(shim) && . ${ME}/i.sh

log:: "initialising bash shell"
# source bashrc which sources nvm and acts as a test that the bash shell is
# set up OK
. ~/.bashrc

if [[ ! -L "$NVM_DIR/bash_completion.d" ]] ; then
  if [[ `uname -m` == 'arm64' ]] ; then
    # Silicon
    ln -s /opt/homebrew/opt/nvm/etc/bash_completion.d $NVM_DIR
  else
    echo "WARN : set up non-silicon"
    exit 1
  fi
fi

# nvm set up is in dotme-bash since it's explictly set here for bash purposes
# with the bash nvm aliases
if ! nvm which default 2>&1>/dev/null ; then
  nvm install node
  nvm alias default node
else
  log:: "nvm default is `nvm which default`"
fi

should-run -fu $0


