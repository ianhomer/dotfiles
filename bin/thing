#!/usr/bin/env python3

import argparse
import os
import subprocess
from datetime import datetime
from pathlib import Path
from lib import thingity


def run():
    parser = argparse.ArgumentParser(description="thing")
    parser.add_argument("thing", nargs="*", help="thing")

    args = parser.parse_args()

    edit(args)


def edit(args):
    now = datetime.now()
    todayLog = thingity.getTodayLog(now)
    if not os.path.isfile(todayLog):
        Path(todayLog).touch()
        with open(todayLog, "w") as file:
            todayLong = now.strftime("%a %d %b %Y").upper()
            file.write(f"# {todayLong}\n\n")

    subprocess.call(
        ["nvim", todayLog], env={**os.environ, "VIM_KNOB": "5"}, cwd=thingity.THINGS_DIR
    )


run()
