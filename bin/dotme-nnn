#!/usr/bin/env sh

#
# Configure nnn
#
# Based on https://github.com/jarun/nnn/blob/master/plugins/getplugs
#

should-run $0 || exit

printf "\e[36mConfiguring nnn\e[0m\n"

CONFIG_DIR=${XDG_CONFIG_HOME:-"$HOME/.config"}/nnn
BOOKMARKS_DIR=${XDG_CACHE_HOME:-"$HOME/.cache"}/nnn/bookmarks
PLUGIN_DIR=${CONFIG_DIR}/plugins
SOURCE_DIR=~/projects/opensource/nnn

if [[ ! -d $SOURCE_DIR ]] ; then
  git clone git@github.com:ianhomer/nnn.git
else
  cd $SOURCE_DIR
  git pull
fi

mkdir -p "$PLUGIN_DIR"

plugins=".nnn-plugin-helper bookmarks fzcd fzopen preview-tui"
ignore=""
for plugin in $plugins ; do ignore="${ignore}(?<!${plugin})" ; done

cd $SOURCE_DIR/plugins
stow -v -t $PLUGIN_DIR --ignore $ignore .

[[ ! -d $BOOKMARKS_DIR ]] && mkdir -p $BOOKMARKS_DIR
cd $BOOKMARKS_DIR

bookmark() {
  [[ ! -L $2 ]] && ( echo "Bookmark : $2 -> $2" ; ln -s $1 $2 )
}

bookmark ~/Downloads downloads
bookmark ~/Desktop desktop
bookmark ~/projects/opensource/nnn nnn

should-run -fu $0
