#!/usr/bin/env python3

import argparse
import configparser
import os.path
from datetime import datetime
from pathlib import Path
home = str(Path.home())

config = configparser.ConfigParser()
config.read(str(Path.home()) + "/.config/dotme/shim.ini")
THINGS_DIR = config['DEFAULT']['THINGS_DIR']


def run():
    print(f"THINGS_DIR {THINGS_DIR}")
    parser = argparse.ArgumentParser(description='todoer')
    parser.add_argument('do', nargs='+', help='do')
    args = parser.parse_args()
    words = []

    # Scan words
    for word in args.do:
        print(f"Word {word}")
        words.append(word)

    # do to add
    do = " ".join(words)
    print(f"Do {do}")
    now = datetime.now()
    today = now.strftime("%m%d")
    todayLog = f"{THINGS_DIR}/my-notes/stream/{today}.md"
    print(f"today {todayLog}")
    if not os.path.isfile(todayLog):
        Path(todayLog).touch()
    with open(todayLog, 'r+') as file:
        file.seek(0)
        lines = file.readlines()
        length = len(lines)
        if length == 0:
            todayLong = now.strftime("%a %m %b %Y").upper()
            lines.append(f"# {todayLong}\n\n")
        elif length == 1:
            lines.append("\n")

        lines.append(f"[ ] {do}\n")
        file.seek(0)
        file.writelines(lines)


run()
